exports.connect=function(e,t){var i=0,s=e,n=null,l=20,o=0,c=1;return t&&void 0!==t.min_pulse&&(o=t.min_pulse),t&&void 0!==t.max_pulse&&(c=t.max_pulse),t&&void 0!==t.interval_time&&(l=t.interval_time),t&&void 0!==t.pos&&(i=E.clip(t.pos*c,o,c)),{init:function(e){var t=10,o=this;n=setInterval(function(){t>0?(digitalPulse(s,1,i),t--):(o.stop(),e&&e())},l)},move:function(e,t,r,u){if(null===n){var a,p=E.clip(e*c,o,c).toFixed(2),v=1e3/l*(t/1e3),d=this,f="cw",m=5e3;if(p=parseFloat(p),null===s)return u&&u({success:!1,details:"servo not initialized"}),!1;i>p?(a=i-p,f="ccw"):i<p?(a=p-i,f="cw"):(a=0,f=""),n=setInterval(function(){if("cw"===f?i+=a/v:i-=a/v,(i=E.clip(parseFloat(i.toFixed(2)),o,c))<p&&"cw"===f||i>p&&"ccw"===f)digitalPulse(s,1,i);else{if(d.stop(),i=p,!(r>0))return u&&u({success:!0,pos:i}),!0;d.holdPos(r,u)}--m<=0&&d.stop()},l)}else u&&u({success:!1,details:"servo currently active"})},holdPos:function(e,t){var o=0,c=this;n=setInterval(function(){if((o+=l)>=e)return c.stop(),t&&t({success:!0,pos:i}),!0;digitalPulse(s,1,i)},l)},getPos:function(){return i},stop:function(){try{clearInterval(n),n=null}catch(e){console.log("clearInterval Error")}}}};
