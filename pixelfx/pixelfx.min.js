exports.init=function(a,b){let c=0,f={interval:null,stepsRemaining:0,reset:function(){if("number"==typeof this.interval){try{clearInterval(this.interval)}catch(h){}this.interval=null}this.stepsRemaining=0}},g={cnt:0,time_on:1e3,time_off:1e3,pixel_colors:null,blink_fx:"sync",color_index:0,pixel_index:0,on:!1,cb:null,timer:null,reset:function(){if("number"==typeof this.timer){try{clearTimeout(this.timer)}catch(h){}this.timer=null}this.cnt=0,this.time_on=1e3,this.time_off=1e3,this.pixel_colors=null,this.blink_fx="sync",this.color_index=0,this.pixel_index=0,this.on=!1,this.cb=null},blink:function(){let h=new Uint8ClampedArray(3*b);if(0<this.cnt){switch(this.blink_fx){case"random":break;case"sequence":for(var i=0;i<h.length;i+=3)h[i]=this.pixel_index===i/3?this.pixel_colors[i]:0,h[i+1]=this.pixel_index===i/3?this.pixel_colors[i+1]:0,h[i+2]=this.pixel_index===i/3?this.pixel_colors[i+2]:0;this.pixel_index++,this.pixel_index>=b&&(this.pixel_index=0);break;default:for(var i=0;i<h.length;i+=3)h[i]=this.on?this.pixel_colors[i]:0,h[i+1]=this.on?this.pixel_colors[i+1]:0,h[i+2]=this.on?this.pixel_colors[i+2]:0;this.on=!this.on;}return require("neopixel").write(a,h),this.cnt--,g.timer=setTimeout(function(){g.blink()},g.on?g.time_off:g.time_on),!0}g.cb&&responder(g.cb,[!0,null,"blink complete"])}};return responder=function(h,i){h&&h({success:i[0],data:i[1],details:i[2]})},{on:function(h){"object"!=typeof h[0]&&(h=[h]);let i=new Uint8ClampedArray(3*b),j=0;for(var k=0;k<i.length;k+=3)i[k]=h[j][0],i[k+1]=h[j][1],i[k+2]=h[j][2],j++,j>=h.length&&(j=0);require("neopixel").write(a,i)},off:function(){let h=new Uint8ClampedArray(3*b);g.reset(),g.cnt=0,f.reset();for(var i=0;i<h.length;i+=3)h[i]=0,h[i+1]=0,h[i+2]=0;require("neopixel").write(a,h)},fade:function(h,i){h.from||responder(i,[!1,null,"missing from color"]),"object"!=typeof h.from[0]&&(h.from=[h.from]),h.to||responder(i,[!1,null,"missing to color"]),"object"!=typeof h.to[0]&&(h.to=[h.to]),h.time||(h.time=1e3),f.interval=null;let j=50*(h.time/1e3),k=[],l=[],m=[],n=[],o=[],q=[],s=new Uint8ClampedArray(3*b);f.stepsRemaining=j;for(var t=0;t<h.to.length;t++)k[t]=(h.to[t][0]-h.from[t][0])/j,l[t]=(h.to[t][1]-h.from[t][1])/j,m[t]=(h.to[t][2]-h.from[t][2])/j,n[t]=h.from[t][0],o[t]=h.from[t][1],q[t]=h.from[t][2];let u=0;for(var t=0;t<s.length;t+=3)s[t]=h.from[u][0],s[t+1]=h.from[u][1],s[t+2]=h.from[u][2],u++,u>=h.from.length&&(u=0);f.interval=setInterval(function(){for(var v=0;v<h.to.length;v++)n[v]+=k[v],o[v]+=l[v],q[v]+=m[v];let w=0;for(var v=0;v<s.length;v+=3)s[v]=n[w],s[v+1]=o[w],s[v+2]=q[w],w++,w>=h.to.length&&(w=0);0>=f.stepsRemaining?(f.reset(),responder(i,[!0,null,"fade complete"])):(require("neopixel").write(a,s),f.stepsRemaining--)},20)},pulse:function(h,i){h.from||responder(i,[!1,null,"missing from color"]),"object"!=typeof h.from[0]&&(h.from=[h.from]),h.to||responder(i,[!1,null,"missing to color"]),"object"!=typeof h.to[0]&&(h.to=[h.to]),h.cnt||(h.cnt=1),h.time_in||(h.time_in=1e3),h.time_out||(h.time_out=1e3);let j=this;this.fade({from:h.from,to:h.to,time:h.time_in},function(){j.fade({to:h.from,from:h.to,time:h.time_out},function(){c++,c>=h.cnt?(responder(i,[!0,null,"pulse complete"]),c=0):j.pulse(h,i)})})},heartbeat:function(h,i){h.color||responder(i,[!1,null,"missing heartbeat color"]),"object"!=typeof h.color[0]&&(h.color=[h.color]),h.cnt||(h.cnt=1),h.rate||(h.rate=1);let j=this,k=[],l=[];h.color.forEach(function(m){k.push([0.25*m[0],0.25*m[1],0.25*m[2]]),l.push([0.1*m[0],0.1*m[1],0.1*m[2]])}),this.fade({from:h.color,to:k,time:350/h.rate},function(){j.fade({from:h.color,to:l,time:550/h.rate},function(){c++,c>=h.cnt?(responder(i,[!0,null,"heartbeat complete"]),c=0):setTimeout(function(){j.heartbeat(h,i)},200)})})},blink:function(h,i){if(g.reset(),!h.color)return void responder(i,[!1,null,"missing heartbeat color"]);switch("object"!=typeof h.color[0]&&(h.color=[h.color]),h.cnt||(h.cnt=1),h.rate?(g.time_on=h.rate,g.time_off=h.rate):(!h.time_on&&(h.time_on=1e3),g.time_on=h.time_on,!h.time_off&&(h.time_off=1e3),g.time_off=h.time_off),h.color_fx||(h.color_fx="set"),g.color_fx=h.color_fx,h.blink_fx||(h.blink_fx="sync"),g.blink_fx=h.blink_fx,h.blink_fx){case"sync":g.cnt=2*h.cnt;break;case"sequence":g.cnt=h.cnt*b;}i&&(g.cb=i);let k=new Uint8ClampedArray(3*b),l=0;for(var m=0;m<k.length;m+=3)k[m]=h.color[l][0],k[m+1]=h.color[l][1],k[m+2]=h.color[l][2],l++,l>=h.color.length&&(l=0);g.pixel_colors=k,g.blink()}}};
