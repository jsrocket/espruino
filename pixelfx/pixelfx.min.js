exports.init=function(a,b){let c=0,f=require("neopixel"),g={interval:null,stepsRemaining:0,reset:function(){if("number"==typeof this.interval){try{clearInterval(this.interval)}catch(i){}this.interval=null}this.stepsRemaining=0}},h={cnt:0,time_on:1e3,time_off:1e3,pixel_colors:null,blink_fx:"sync",color_index:0,pixel_index:0,on:!1,cb:null,timer:null,reset:function(){if("number"==typeof this.timer){try{clearTimeout(this.timer)}catch(i){}this.timer=null}this.cnt=0,this.time_on=1e3,this.time_off=1e3,this.pixel_colors=null,this.blink_fx="sync",this.color_index=0,this.pixel_index=0,this.on=!1,this.cb=null},blink:function(){let i=new Uint8ClampedArray(3*b);if(0<this.cnt){switch(this.blink_fx){case"random":break;case"sequence":for(var j=0;j<i.length;j+=3)i[j]=this.pixel_index===j/3?this.pixel_colors[j]:0,i[j+1]=this.pixel_index===j/3?this.pixel_colors[j+1]:0,i[j+2]=this.pixel_index===j/3?this.pixel_colors[j+2]:0;this.pixel_index++,this.pixel_index>=b&&(this.pixel_index=0);break;default:for(var j=0;j<i.length;j+=3)i[j]=this.on?this.pixel_colors[j]:0,i[j+1]=this.on?this.pixel_colors[j+1]:0,i[j+2]=this.on?this.pixel_colors[j+2]:0;this.on=!this.on;}return f.write(a,i),this.cnt--,h.timer=setTimeout(function(){h.blink()},h.on?h.time_off:h.time_on),!0}h.cb&&responder(h.cb,[!0,null,"blink complete"])}};return responder=function(i,j){i&&i({success:j[0],data:j[1],details:j[2]})},{on:function(i){"object"!=typeof i[0]&&(i=[i]);let j=new Uint8ClampedArray(3*b),k=0;for(var l=0;l<j.length;l+=3)j[l]=i[k][0],j[l+1]=i[k][1],j[l+2]=i[k][2],k++,k>=i.length&&(k=0);f.write(a,j)},off:function(){let i=new Uint8ClampedArray(3*b);h.reset(),h.cnt=0,g.reset();for(var j=0;j<i.length;j+=3)i[j]=0,i[j+1]=0,i[j+2]=0;f.write(a,i)},fade:function(i,j){i.from||responder(j,[!1,null,"missing from color"]),"object"!=typeof i.from[0]&&(i.from=[i.from]),i.to||responder(j,[!1,null,"missing to color"]),"object"!=typeof i.to[0]&&(i.to=[i.to]),i.time||(i.time=1e3),g.interval=null;let k=50*(i.time/1e3),l=[],m=[],n=[],o=[],q=[],s=[],t=new Uint8ClampedArray(3*b);g.stepsRemaining=k;for(var u=0;u<i.to.length;u++)l[u]=(i.to[u][0]-i.from[u][0])/k,m[u]=(i.to[u][1]-i.from[u][1])/k,n[u]=(i.to[u][2]-i.from[u][2])/k,o[u]=i.from[u][0],q[u]=i.from[u][1],s[u]=i.from[u][2];let v=0;for(var u=0;u<t.length;u+=3)t[u]=i.from[v][0],t[u+1]=i.from[v][1],t[u+2]=i.from[v][2],v++,v>=i.from.length&&(v=0);g.interval=setInterval(function(){for(var w=0;w<i.to.length;w++)o[w]+=l[w],q[w]+=m[w],s[w]+=n[w];let x=0;for(var w=0;w<t.length;w+=3)t[w]=o[x],t[w+1]=q[x],t[w+2]=s[x],x++,x>=i.to.length&&(x=0);0>=g.stepsRemaining?(g.reset(),responder(j,[!0,null,"fade complete"])):(f.write(a,t),g.stepsRemaining--)},20)},pulse:function(i,j){i.from||responder(j,[!1,null,"missing from color"]),"object"!=typeof i.from[0]&&(i.from=[i.from]),i.to||responder(j,[!1,null,"missing to color"]),"object"!=typeof i.to[0]&&(i.to=[i.to]),i.cnt||(i.cnt=1),i.time_in||(i.time_in=1e3),i.time_out||(i.time_out=1e3);let k=this;this.fade({from:i.from,to:i.to,time:i.time_in},function(){k.fade({to:i.from,from:i.to,time:i.time_out},function(){c++,c>=i.cnt?(responder(j,[!0,null,"pulse complete"]),c=0):k.pulse(i,j)})})},heartbeat:function(i,j){i.color||responder(j,[!1,null,"missing heartbeat color"]),"object"!=typeof i.color[0]&&(i.color=[i.color]),i.cnt||(i.cnt=1),i.rate||(i.rate=1);let k=this,l=[],m=[];i.color.forEach(function(n){l.push([0.25*n[0],0.25*n[1],0.25*n[2]]),m.push([0.1*n[0],0.1*n[1],0.1*n[2]])}),this.fade({from:i.color,to:l,time:350/i.rate},function(){k.fade({from:i.color,to:m,time:550/i.rate},function(){c++,c>=i.cnt?(responder(j,[!0,null,"heartbeat complete"]),c=0):setTimeout(function(){k.heartbeat(i,j)},200)})})},blink:function(i,j){if(h.reset(),!i.color)return void responder(j,[!1,null,"missing heartbeat color"]);switch("object"!=typeof i.color[0]&&(i.color=[i.color]),i.cnt||(i.cnt=1),i.rate?(h.time_on=i.rate,h.time_off=i.rate):(!i.time_on&&(i.time_on=1e3),h.time_on=i.time_on,!i.time_off&&(i.time_off=1e3),h.time_off=i.time_off),i.color_fx||(i.color_fx="set"),h.color_fx=i.color_fx,i.blink_fx||(i.blink_fx="sync"),h.blink_fx=i.blink_fx,i.blink_fx){case"sync":h.cnt=2*i.cnt;break;case"sequence":h.cnt=i.cnt*b;}j&&(h.cb=j);let l=new Uint8ClampedArray(3*b),m=0;for(var n=0;n<l.length;n+=3)l[n]=i.color[m][0],l[n+1]=i.color[m][1],l[n+2]=i.color[m][2],m++,m>=i.color.length&&(m=0);h.pixel_colors=l,h.blink()}}};
