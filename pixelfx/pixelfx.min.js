exports.init=function(a,b){let c=0,e={interval:null,stepsRemaining:0,reset:function(){"number"==typeof this.interval&&(clearInterval(this.interval),this.interval=null),this.stepsRemaining=0}},f={cnt:0,rate_on:1,rate_off:1,pixel_colors:null,blink_fx:"sync",color_index:0,pixel_index:0,on:!1,cb:null,timer:null,reset:function(){"number"==typeof this.timer&&(clearTimeout(this.timer),this.timer=null),this.cnt=0,this.rate_on=1,this.rate_off=1,this.pixel_colors=null,this.blink_fx="sync",this.color_index=0,this.pixel_index=0,this.on=!1,this.cb=null},blink:function(){let g=new Uint8ClampedArray(3*b);if(0<this.cnt){switch(this.blink_fx){case"random":break;case"sequence":for(var h=0;h<g.length;h+=3)g[h]=this.pixel_index===h/3?this.pixel_colors[h]:0,g[h+1]=this.pixel_index===h/3?this.pixel_colors[h+1]:0,g[h+2]=this.pixel_index===h/3?this.pixel_colors[h+2]:0;this.pixel_index++,this.pixel_index>=b&&(this.pixel_index=0);break;default:for(var h=0;h<g.length;h+=3)g[h]=this.on?this.pixel_colors[h]:0,g[h+1]=this.on?this.pixel_colors[h+1]:0,g[h+2]=this.on?this.pixel_colors[h+2]:0;this.on=!this.on;}return require("neopixel").write(a,g),this.cnt--,f.timer=setTimeout(function(){f.blink()},1e3*(f.on?f.rate_off:f.rate_on)),!0}f.cb&&responder(f.cb,[!0,null,"blink complete"])}};return responder=function(g,h){g&&g({success:h[0],data:h[1],details:h[2]})},{on:function(g){"object"!=typeof g[0]&&(g=[g]);let h=new Uint8ClampedArray(3*b),i=0;for(var j=0;j<h.length;j+=3)h[j]=g[i][0],h[j+1]=g[i][1],h[j+2]=g[i][2],i++,i>=g.length&&(i=0);require("neopixel").write(a,h)},off:function(){let g=new Uint8ClampedArray(3*b);f.reset(),f.cnt=0,e.reset();for(var h=0;h<g.length;h+=3)g[h]=0,g[h+1]=0,g[h+2]=0;require("neopixel").write(a,g)},fade:function(g,h){g.from||responder(h,[!1,null,"missing from color"]),"object"!=typeof g.from[0]&&(g.from=[g.from]),g.to||responder(h,[!1,null,"missing to color"]),"object"!=typeof g.to[0]&&(g.to=[g.to]),g.time||(g.time=1e3),e.interval=null;let i=50*(g.time/1e3),j=[],k=[],l=[],m=[],n=[],o=[],q=new Uint8ClampedArray(3*b);e.stepsRemaining=i;for(var s=0;s<g.to.length;s++)j[s]=(g.to[s][0]-g.from[s][0])/i,k[s]=(g.to[s][1]-g.from[s][1])/i,l[s]=(g.to[s][2]-g.from[s][2])/i,m[s]=g.from[s][0],n[s]=g.from[s][1],o[s]=g.from[s][2];let t=0;for(var s=0;s<q.length;s+=3)q[s]=g.from[t][0],q[s+1]=g.from[t][1],q[s+2]=g.from[t][2],t++,t>=g.from.length&&(t=0);e.interval=setInterval(function(){for(var u=0;u<g.to.length;u++)m[u]+=j[u],n[u]+=k[u],o[u]+=l[u];let v=0;for(var u=0;u<q.length;u+=3)q[u]=m[v],q[u+1]=n[v],q[u+2]=o[v],v++,v>=g.to.length&&(v=0);0>=e.stepsRemaining?(e.reset(),responder(h,[!0,null,"fade complete"])):(require("neopixel").write(a,q),e.stepsRemaining--)},20)},pulse:function(g,h){g.from||responder(h,[!1,null,"missing from color"]),"object"!=typeof g.from[0]&&(g.from=[g.from]),g.to||responder(h,[!1,null,"missing to color"]),"object"!=typeof g.to[0]&&(g.to=[g.to]),g.cnt||(g.cnt=1),g.time_in||(g.time_in=1e3),g.time_out||(g.time_out=1e3);let i=this;this.fade({from:g.from,to:g.to,time:g.time_in},function(){i.fade({to:g.from,from:g.to,time:g.time_out},function(){c++,c>=g.cnt?(responder(h,[!0,null,"pulse complete"]),c=0):i.pulse(g,h)})})},heartbeat:function(g,h){g.color||responder(h,[!1,null,"missing heartbeat color"]),"object"!=typeof g.color[0]&&(g.color=[g.color]),g.cnt||(g.cnt=1),g.rate||(g.rate=1);let i=this,j=[],k=[];g.color.forEach(function(l){j.push([0.25*l[0],0.25*l[1],0.25*l[2]]),k.push([0.1*l[0],0.1*l[1],0.1*l[2]])}),this.fade({from:g.color,to:j,time:350/g.rate},function(){i.fade({from:g.color,to:k,time:550/g.rate},function(){c++,c>=g.cnt?(responder(h,[!0,null,"heartbeat complete"]),c=0):setTimeout(function(){i.heartbeat(g,h)},200)})})},blink:function(g,h){if(f.reset(),!g.color)return void responder(h,[!1,null,"missing heartbeat color"]);switch("object"!=typeof g.color[0]&&(g.color=[g.color]),g.cnt||(g.cnt=1),g.rate?(f.rate_on=g.rate,f.rate_off=g.rate):(!g.rate_on&&(g.rate_on=1),f.rate_on=g.rate_on,!g.rate_off&&(g.rate_off=1),f.rate_off=g.rate_off),g.color_fx||(g.color_fx="set"),f.color_fx=g.color_fx,g.blink_fx||(g.blink_fx="sync"),f.blink_fx=g.blink_fx,g.blink_fx){case"sync":f.cnt=2*g.cnt;break;case"sequence":f.cnt=g.cnt*b;}h&&(f.cb=h);let j=new Uint8ClampedArray(3*b),k=0;for(var l=0;l<j.length;l+=3)j[l]=g.color[k][0],j[l+1]=g.color[k][1],j[l+2]=g.color[k][2],k++,k>=g.color.length&&(k=0);f.pixel_colors=j,f.blink()}}};
